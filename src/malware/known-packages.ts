/**
 * Known malware packages database
 * Source: npm advisories, Snyk, Socket.dev, CISA alerts
 * Last updated: 2026-02-04
 */

// Packages that had confirmed malware at some point
export const KNOWN_MALWARE_PACKAGES = new Set([
  // === 2018-2022 Classic Supply Chain Attacks ===
  'event-stream',           // 2018 - Bitcoin wallet stealer
  'flatmap-stream',         // 2018 - event-stream dependency
  'ua-parser-js',           // 2021 - Cryptocurrency miner
  'coa',                    // 2021 - Compromised
  'rc',                     // 2021 - Compromised  
  'colors',                 // 2022 - Intentional sabotage (AMERICAN FLAG)
  'faker',                  // 2022 - Intentional sabotage
  'node-ipc',               // 2022 - Protestware (peacenotwar)
  
  // === Typosquatting Attacks ===
  'crossenv',               // Typosquat of cross-env
  'cross-env.js',           // Typosquat of cross-env
  'mongose',                // Typosquat of mongoose
  'expresss',               // Typosquat of express
  'loadsh',                 // Typosquat of lodash
  'lodashs',                // Typosquat of lodash
  'babelcli',               // Typosquat of babel-cli
  'jquey',                  // Typosquat of jquery
  'electorn',               // Typosquat of electron
  
  // === 2024-2025 Crypto Wallet Attacks ===
  'ethers-provider2',       // 2024 - Wallet drainer
  'ethers-providerz',       // 2024 - Wallet drainer
  '@pika/chalk',            // Malicious fork
  'chalk-next',             // Malicious fork
  
  // === 2025 September "Shai-Hulud" Attack ===
  // Massive supply chain attack targeting 18+ packages
  // Reference: CISA alert, Palo Alto Unit42
  
  // === PyPI Malware ===
  'num2words',              // 2025 - Phishing attack (versions 0.5.15, 0.5.16)
  'sisaws',                 // 2025 - SilentSync RAT
  'secmeasure',             // 2025 - SilentSync RAT
  'soopsocks',              // 2025 - Malware (2653 downloads)
  'spellcheckers',          // 2025 - Multi-stage backdoor
  'semantic-types',         // 2025 - Solana key stealer (updated Jan 2025)
  
  // === crates.io Malware ===
  'faster_log',             // 2025 - Typosquat, crypto wallet stealer
  'async_println',          // 2025 - Crypto wallet stealer
]);

/**
 * Detailed malware information
 */
const MALWARE_DETAILS: Record<string, {
  year: number;
  description: string;
  severity: 'critical' | 'high' | 'medium';
  type: 'supply-chain' | 'typosquat' | 'sabotage' | 'protestware' | 'crypto-stealer';
}> = {
  'event-stream': {
    year: 2018,
    description: 'Bitcoin wallet stealer injected via flatmap-stream dependency',
    severity: 'critical',
    type: 'supply-chain',
  },
  'ua-parser-js': {
    year: 2021,
    description: 'Cryptocurrency miner injection via compromised maintainer account',
    severity: 'critical',
    type: 'supply-chain',
  },
  'colors': {
    year: 2022,
    description: 'Intentional sabotage - infinite loop (AMERICAN FLAG protest)',
    severity: 'high',
    type: 'sabotage',
  },
  'faker': {
    year: 2022,
    description: 'Intentional sabotage by maintainer',
    severity: 'high',
    type: 'sabotage',
  },
  'node-ipc': {
    year: 2022,
    description: 'Protestware - peacenotwar module targeting Russian/Belarusian IPs',
    severity: 'high',
    type: 'protestware',
  },
  'coa': {
    year: 2021,
    description: 'Compromised via maintainer account phishing',
    severity: 'critical',
    type: 'supply-chain',
  },
  'rc': {
    year: 2021,
    description: 'Compromised via maintainer account phishing',
    severity: 'critical',
    type: 'supply-chain',
  },
  'ethers-provider2': {
    year: 2024,
    description: 'Cryptocurrency wallet drainer targeting Ethereum users',
    severity: 'critical',
    type: 'crypto-stealer',
  },
  'num2words': {
    year: 2025,
    description: 'PyPI phishing attack - malicious versions 0.5.15, 0.5.16',
    severity: 'high',
    type: 'supply-chain',
  },
  'faster_log': {
    year: 2025,
    description: 'crates.io typosquat of fast_log - crypto wallet key stealer',
    severity: 'critical',
    type: 'typosquat',
  },
  'async_println': {
    year: 2025,
    description: 'crates.io malicious crate - crypto wallet key stealer',
    severity: 'critical',
    type: 'crypto-stealer',
  },
};

/**
 * Check if a package has known malware history
 */
export function hasMalwareHistory(packageName: string): boolean {
  return KNOWN_MALWARE_PACKAGES.has(packageName.toLowerCase());
}

/**
 * Get malware details if known
 */
export function getMalwareDetails(packageName: string): string | null {
  const info = MALWARE_DETAILS[packageName.toLowerCase()];
  if (info) {
    return `${info.description} (${info.year})`;
  }
  
  // Fallback for packages in the set but without detailed info
  if (KNOWN_MALWARE_PACKAGES.has(packageName.toLowerCase())) {
    return 'Known malicious package';
  }
  
  return null;
}

/**
 * Get full malware info
 */
export function getMalwareInfo(packageName: string) {
  return MALWARE_DETAILS[packageName.toLowerCase()] || null;
}
