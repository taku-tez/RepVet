/**
 * Known malware packages database
 * Source: npm advisories, Snyk, Socket.dev, CISA alerts
 * Last updated: 2026-02-04
 */

// Packages that had confirmed malware at some point
export const KNOWN_MALWARE_PACKAGES = new Set([
  // === 2018-2022 Classic Supply Chain Attacks ===
  'event-stream',           // 2018 - Bitcoin wallet stealer
  'flatmap-stream',         // 2018 - event-stream dependency
  'ua-parser-js',           // 2021 - Cryptocurrency miner
  'coa',                    // 2021 - Compromised
  'rc',                     // 2021 - Compromised  
  'colors',                 // 2022 - Intentional sabotage (AMERICAN FLAG)
  'faker',                  // 2022 - Intentional sabotage
  'node-ipc',               // 2022 - Protestware (peacenotwar)
  
  // === Typosquatting Attacks ===
  'crossenv',               // Typosquat of cross-env
  'cross-env.js',           // Typosquat of cross-env
  'mongose',                // Typosquat of mongoose
  'expresss',               // Typosquat of express
  'loadsh',                 // Typosquat of lodash
  'lodashs',                // Typosquat of lodash
  'babelcli',               // Typosquat of babel-cli
  'jquey',                  // Typosquat of jquery
  'electorn',               // Typosquat of electron
  
  // === 2024-2025 Crypto Wallet Attacks ===
  'ethers-provider2',       // 2024 - Wallet drainer
  'ethers-providerz',       // 2024 - Wallet drainer
  '@pika/chalk',            // Malicious fork
  'chalk-next',             // Malicious fork
  
  // === 2025 Ethereum Smart Contract Malware ===
  'colortoolsv2',           // 2025 - Uses Ethereum smart contracts for C2
  'mimelib2',               // 2025 - Uses Ethereum smart contracts for C2
  
  // === 2026 G_Wagon Infostealer Campaign ===
  'ansi-universal-ui',      // 2026 - G_Wagon infostealer, crypto wallet stealer
  
  // === 2025 September-November "Shai-Hulud" Attack ===
  // Massive supply chain worm targeting npm ecosystem
  // Reference: CISA alert, Palo Alto Unit42, Aikido Security
  // V1 (Sept 2025): ~200 packages
  // V2 (Nov 2025): 700+ packages, 27k GitHub repos, Dead Man's Switch
  // V3 (Dec 2025): @vietmoney scope packages
  '@vietmoney/react-big-calendar',        // V3.0 - confirmed malicious
  '@vietmoney/react-native-smart-page',   // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-smart-gallery',// V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-true-id',      // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-tags-input',   // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-vnpay-merchant', // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-image-transformer', // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-htmlview',     // V3.0 - Shai-Hulud payload
  '@vietmoney/react-native-action-button',// V3.0 - Shai-Hulud payload
  '@vietmoney/vietmoneywork',             // V3.0 - Shai-Hulud payload
  '@nativescript-community/perms',        // V2.0 - Shai-Hulud (Nov 2025)
  
  // === PyPI Malware ===
  'num2words',              // 2025 - Phishing attack (versions 0.5.15, 0.5.16)
  'sisaws',                 // 2025 - SilentSync RAT
  'secmeasure',             // 2025 - SilentSync RAT
  'soopsocks',              // 2025 - Malware (2653 downloads)
  'spellcheckers',          // 2025 - Multi-stage backdoor
  'semantic-types',         // 2025 - Solana key stealer (updated Jan 2025)
  
  // === crates.io Malware ===
  'faster_log',             // 2025 - Typosquat, crypto wallet stealer
  'async_println',          // 2025 - Crypto wallet stealer
]);

/**
 * Detailed malware information
 */
const MALWARE_DETAILS: Record<string, {
  year: number;
  description: string;
  severity: 'critical' | 'high' | 'medium';
  type: 'supply-chain' | 'typosquat' | 'sabotage' | 'protestware' | 'crypto-stealer';
}> = {
  'event-stream': {
    year: 2018,
    description: 'Bitcoin wallet stealer injected via flatmap-stream dependency',
    severity: 'critical',
    type: 'supply-chain',
  },
  'ua-parser-js': {
    year: 2021,
    description: 'Cryptocurrency miner injection via compromised maintainer account',
    severity: 'critical',
    type: 'supply-chain',
  },
  'colors': {
    year: 2022,
    description: 'Intentional sabotage - infinite loop (AMERICAN FLAG protest)',
    severity: 'high',
    type: 'sabotage',
  },
  'faker': {
    year: 2022,
    description: 'Intentional sabotage by maintainer',
    severity: 'high',
    type: 'sabotage',
  },
  'node-ipc': {
    year: 2022,
    description: 'Protestware - peacenotwar module targeting Russian/Belarusian IPs',
    severity: 'high',
    type: 'protestware',
  },
  'coa': {
    year: 2021,
    description: 'Compromised via maintainer account phishing',
    severity: 'critical',
    type: 'supply-chain',
  },
  'rc': {
    year: 2021,
    description: 'Compromised via maintainer account phishing',
    severity: 'critical',
    type: 'supply-chain',
  },
  'ethers-provider2': {
    year: 2024,
    description: 'Cryptocurrency wallet drainer targeting Ethereum users',
    severity: 'critical',
    type: 'crypto-stealer',
  },
  'num2words': {
    year: 2025,
    description: 'PyPI phishing attack - malicious versions 0.5.15, 0.5.16',
    severity: 'high',
    type: 'supply-chain',
  },
  'faster_log': {
    year: 2025,
    description: 'crates.io typosquat of fast_log - crypto wallet key stealer',
    severity: 'critical',
    type: 'typosquat',
  },
  'async_println': {
    year: 2025,
    description: 'crates.io malicious crate - crypto wallet key stealer',
    severity: 'critical',
    type: 'crypto-stealer',
  },
  'colortoolsv2': {
    year: 2025,
    description: 'Uses Ethereum smart contracts to conceal C2 commands, installs downloader malware',
    severity: 'critical',
    type: 'supply-chain',
  },
  'mimelib2': {
    year: 2025,
    description: 'Uses Ethereum smart contracts to conceal C2 commands, installs downloader malware',
    severity: 'critical',
    type: 'supply-chain',
  },
  'ansi-universal-ui': {
    year: 2026,
    description: 'G_Wagon infostealer - targets 100+ crypto wallets, browser creds, cloud keys',
    severity: 'critical',
    type: 'crypto-stealer',
  },
  // === Shai-Hulud V3.0 Campaign (Dec 2025) ===
  '@vietmoney/react-big-calendar': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm, steals secrets, propagates via npm tokens',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-smart-page': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-smart-gallery': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-true-id': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-tags-input': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-vnpay-merchant': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-image-transformer': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-htmlview': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/react-native-action-button': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@vietmoney/vietmoneywork': {
    year: 2025,
    description: 'Shai-Hulud V3.0 - npm supply chain worm',
    severity: 'critical',
    type: 'supply-chain',
  },
  '@nativescript-community/perms': {
    year: 2025,
    description: 'Shai-Hulud V2.0 - npm supply chain worm with Dead Man Switch',
    severity: 'critical',
    type: 'supply-chain',
  },
};

/**
 * Check if a package has known malware history
 */
export function hasMalwareHistory(packageName: string): boolean {
  return KNOWN_MALWARE_PACKAGES.has(packageName.toLowerCase());
}

/**
 * Get malware details if known
 */
export function getMalwareDetails(packageName: string): string | null {
  const info = MALWARE_DETAILS[packageName.toLowerCase()];
  if (info) {
    return `${info.description} (${info.year})`;
  }
  
  // Fallback for packages in the set but without detailed info
  if (KNOWN_MALWARE_PACKAGES.has(packageName.toLowerCase())) {
    return 'Known malicious package';
  }
  
  return null;
}

/**
 * Get full malware info
 */
export function getMalwareInfo(packageName: string) {
  return MALWARE_DETAILS[packageName.toLowerCase()] || null;
}
